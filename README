# Stumeta Workshop/Exkursion Zuordnung 

Sortiert Teilnehmende der StuMeTa in Workshops und Exkursionen basiert auf ihren Präferenzen ein.

Die Sortierung basiert auf dem "Minimum-Cost Flow Problem", das eine optimale Zuordnung berechnet.
Jeder erfüllten Wahl (1. Wahl, 2. Wahl, etc.) wird am Anfang ein "Kostenfaktor" als Gewichtung gegeben (siehe Anwendung).
Dann werden für jede Zuordnungskombination die "Gesamtkosten" berechnet und die Kombination mit den geringsten "Gesamtkosten" wird ausgegeben. 

Die Ausgabe ist eine CSV-Datei (results.csv), die den Namen und den Zugeordneten Workshop/Exkursion enthält. 
Die Datei kann dann an die Teilnehmenden weitergegeben werden (bzw. vorher im Tabellenkalkulationsprogramm aufbereitet werden). Der "Name" besteht aus dem Vornamen, der Stadt und (aus Datenschutzgründen) dem ersten Buchstaben des Nachnamen. Bei gleicher Stadt, gleichem Vornamen und gleichen Anfangsbuchstaben des Nachnamen werden weitere Buchstaben angehängt.

Zudem wird eine Datei mit Statistiken (stats.txt) erzeugt, die angiebt wie häufig jeder Workshop/Exkursion zugeordnet wurde welche Wahl (1. Wahl, 2. Wahl, etc.) wie häufig erfüllt wurde.

## 1. Vorbereitung

### uv
Das Programm ist ein einfaches Python-Script, daher kann es auch mit einer bereits vorhandenen Python-Installation laufen, die Voraussetzungen sind in den ersten Zeilen von "allocator.py" zu finden.
uv ist jedoch die mit Abstand schnellste und einfachste Methode, Python Installationen zu verwalten. Daher verwendet diese Anleitung uv und das Programm wurde auch nur mit uv getestet. Mehr Infos zu uv hier: https://docs.astral.sh/uv/

Falls uv nicht bereits installiert wurde, kann der folgende Befehl im Terminal ausgeführt werden:

Linux/Mac:
curl -LsSf https://astral.sh/uv/install.sh | sh

Windows:
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

### Teilnehmendenliste mit Präferenzen und Kapazitätsdateien
Als Input werden die Teilnehmendenliste (mit Vorname, Nachname, Stadt und Präferenzen für Workshops und Exkursionen) im CSV-Format (z.B. der Output der Lotterie) und Kapazitäts-Dateien im CSV-Format, die die maximale Anzahl an Plätzen der Workshops/Exkursionen enthält, benötigt. 

Eine Zeile in der Kapazitätdatei für Workshops sieht z.B. so aus:

Beispiel Workshop,15

Im Unterordner "example/" gibt es Beispiele für alle drei Dateien.

### Setup Datei
Die Datei "setup.toml" öffnen und mit den richten Pfaden und Spalten ausfüllen. 

Wenn es noch keine realen Anmeldedaten gibt, können die default-Werte für die Input-Dateien stehen bleiben. Dann werden die Beispieldatein aus dem Unterordner "example/" verwendet.

## 2. Anwendung
Terminal öffnen und folgenden Befehl eingeben:

uv run allocator.py

Dadurch werden die Zuordnungsliste (results.csv) und eine Datei mit Statistiken (stats.txt)  im Unterordner "output/" (falls der Pfad im setup file nicht geändert wurde) erzeugt.

Beim ersten Ausführen kann es etwas länger dauern, da die Module geladen werden müssen. 

Wenn Mac/Linux benutzt wird, kann allocator.py auch ausführbar gemacht werden (chmod +x allocator.py), dann muss man als Befehl nur "./allocator.py" eingeben. 

Bei Bedarf können die Gewichtungen (cost) für die Wahlen in "setup.toml" angepasst werden. Eine höhere Zahl macht das Vorkommen dieser Wahl unwarscheinlicher.

Eine Zuordnung zu keiner der 3 Wahlen ist nicht möglich (Und würde bestimmt Leute unglücklich machen). Falls mit den in den Kapazitätsdateien angebenen Obergrenzen keine Zuordnung möglich ist, berechnet das Programm automatisch, welche Kapazitätserhöhungen bei welchen Workshops/Exkursionen eine Zuordnung möglich machen würden. Dabei ist auch eine Kombination über jeweils mehrere Workshops/Exkursionen möglich.

Es kann passieren, dass ein Workshop/Exkursion nur wenige Zuordnungen hat. Falls man möchte, dass jedem Workshop/Exkursion mindestens eine bestimmte Anzahl an Teilnehmenden zugeordnet ist, hilft die Option "lowalloc_threshold" in der Setup-Datei. Gibt es einen Workshop/Exkursion mit weniger Zuordnungen als dieser Wert, gibt das Programm eine Warnung aus und zeigt, zu welchen Workshops/Exkursionen die Leute zugeordnet wurden, die den Workshops/Exkursion auch als eine ihrer Wahlen hatten. Falls der Workshop/Exkursion voll ist (siehe stats.txt), kann durch Reduktion der Obergrenze in der Kapazitätsdatei ein Verschieben der Leute in den gewünschten Workshop/Exkursion erreicht werden. Zudem kann auch eine höhere Gewichtung der 3. Wahl helfen. Die Warnung wird nicht ausgegeben, wenn die Obergrenze nicht größer als die Option "lowalloc_threshold" ist.

Falls ein Workshop/Exkursion nicht stattfinden soll, kann die Obergrenze in der Kapazitätsdatei auf 0 gesetzt oder die entsprechende Zeile gelöscht werden.
